import{Q as V,j as E,r as D,L as w,cl as I,l as S,q as $,t,n as c,z as n,S as U,C as P,a_ as O,a0 as y,Y as R,bf as B,m as z,U as M,V as L,W as N,cg as q,a2 as F,X as A}from"./index-999588c8.js";import{c as K,a as Q,b as W,E as X}from"./el-form-item-fcf7e774.js";import{S as j}from"./index-30f94e2d.js";import{_ as T,e as Y,c as G,g as H,b as J,d as Z,f as b,a as x}from"./CropperImg-c810b854.js";import{v as ee}from"./VerifiedTools-314f4468.js";import{E as ae}from"./el-dialog-88356803.js";const k={open:{default:!1},title:{default:"头像选择裁剪"},afterTitle:{default:""},isShow:{default:!1}},ne=E({name:"EditDataDialog",components:{CropperImg:T},setup(){const e=D(null),a=w({}),o=w({loading:!1,closeType:"close",resolve:void 0,reject:void 0,imgUrl_1:""}),p={castParams:{}};I(a,{},k);function r(){o.closeType=="confirm"?o.resolve(p.castParams):o.reject(o.closeType,p.castParams)}function C(i=!0,d={},s={}){return I(a,s,k),o.closeType="close",o.loading=!1,o.imgUrl_1="",p.castParams={},a.open=i,O(()=>{e.value&&e.value.initData({imgUrl:d.url})}),new Promise((l,f)=>{o.resolve=l,o.reject=f})}function g(){p.castParams={url:o.imgUrl_1,file:o.imgUrl_1?Y(o.imgUrl_1,"img.png"):null},o.closeType="confirm",a.open=!1}function h(i){i=i||{};let d=i.canvas;d&&(o.imgUrl_1=d.toDataURL("image/jpeg"))}let _=1024*1024*7,m=1024*1,u="image/png,image/jpeg";function v(){G({multiple:!1,accept:"image/png,image/jpeg"}).then(i=>{let d=H(i.name),s=i.type||J(i.name)||"",l=Z(s),f=i.size;if(!u.includes(s)&&!u.includes(l)&&!u.includes(d)){y(`文件类型${s}不正确，正确类型:${u}`);return}if(f>_||f<m){y(`文件大小${b(f)}超出范围：${b(m)} - ${b(_)}之间。`);return}e.value&&e.value.initData({imgUrl:URL.createObjectURL(i)})}).catch(()=>{})}return{configData:a,initData:C,dataContainer:o,handleClose:r,handleSubmit:g,handleChooseFile:v,CropperImgRef:e,handleCrop:h}}}),oe={class:"dialog-container"},le={class:"container"},te={class:"left"},ie={class:"right"},se=["src"],re={class:"dialog-footer"};function de(e,a,o,p,r,C){const g=R,h=T,_=ae;return S(),$(_,{title:e.configData.title+e.configData.afterTitle,modelValue:e.configData.open,"onUpdate:modelValue":a[1]||(a[1]=m=>e.configData.open=m),width:"600px","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":"",onClose:e.handleClose,class:"edit-data-dialog"},{footer:t(()=>[c("div",re,[n(g,{onClick:a[0]||(a[0]=()=>{e.dataContainer.closeType="cancel",e.configData.open=!1})},{default:t(()=>[U(" 取消 ")]),_:1}),e.configData.isShow?P("",!0):(S(),$(g,{key:0,type:"primary",onClick:e.handleSubmit},{default:t(()=>[U(" 确定选择 ")]),_:1},8,["onClick"]))])]),default:t(()=>[c("div",oe,[n(g,{type:"primary",onClick:e.handleChooseFile},{default:t(()=>[U(" 点击选择本地图片（大小1K - 7M） ")]),_:1},8,["onClick"]),c("div",le,[c("div",te,[n(h,{onOnCrop:e.handleCrop,ref:"CropperImgRef"},null,8,["onOnCrop"])]),c("div",ie,[c("img",{class:"img",src:e.dataContainer.imgUrl_1,alt:""},null,8,se)])])])]),_:1},8,["title","modelValue","onClose"])}const me=V(ne,[["render",de],["__scopeId","data-v-554b69b7"]]);const ue=E({components:{SvgIcon:j,ChangeImgDialog:me},setup(){let e=M();const a=D(null),o=D(null),p=D(null);L(),N();const r=w({loading:!1,form:{},rules:{name:[{required:!0,message:"请输入昵称",trigger:"blur"}]},imgUrl_3:"https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"}),C={imgFile:null};function g(){let s=e.userInfo;r.form=q(s),r.imgUrl_3=r.form.avatar}g();function h(){a.value&&a.value.validate((s,l)=>{if(l){let f=l[Object.keys(l)[0]][0].message;y(f);return}if(l=_(r.form),l){y(l[0].msg);return}s&&F("提交成功！")})}function _(s){return ee(s,{name:{msg:"昵称 不能为空",validate(f,Ce){return!(!f&&f!==0)}}})}function m(){o.value&&o.value.initData(!0,{url:r.imgUrl_3}).then(s=>{r.imgUrl_3=s.url||"",C.imgFile=s.file||null}).catch(()=>{})}function u(){C.imgFile&&p.value&&p.value.handleUpload(C.imgFile).then(()=>{}).catch(()=>{})}function v(){F("文件上传成功")}function i(){y("文件上传失败")}function d(){r.imgUrl_3="",C.imgFile=null}return{dataContainer:r,FormElRef:a,handleSubmit:h,ChangeImgDialogRef:o,changeImg:m,handleUploadSuccess:v,handleUploadFail:i,handleUploadCancel:d,UploadSingleImgRef:p,handleUpload:u}}}),ce={class:"page-container mine-view"},pe={class:"container img-container"},fe={class:"img-upload"},ge={class:"container"};function _e(e,a,o,p,r,C){const g=x,h=j,_=R,m=Q,u=W,v=X,i=K,d=A,s=B("ChangeImgDialog");return S(),z("div",ce,[c("div",pe,[n(i,{style:{width:"100%"},model:e.dataContainer.form,inline:!1,"label-width":"120px"},{default:t(()=>[n(v,{gutter:0},{default:t(()=>[n(u,{span:24},{default:t(()=>[n(m,{label:"用户头像",prop:""},{default:t(()=>[c("div",null,[c("div",fe,[n(g,{ref:"UploadSingleImgRef",imgUrl:e.dataContainer.imgUrl_3,showCancelBt:!!e.dataContainer.imgUrl_3,maxSize:1024*1024*7,minSize:1024*7,needAccept:"image/png,image/jpeg",autoUpload:!1,showChooseBt:!1,uploadApi:"/upload-api/upload",onOnSuccess:e.handleUploadSuccess,onOnFail:e.handleUploadFail,onOnCancel:e.handleUploadCancel},null,8,["imgUrl","showCancelBt","onOnSuccess","onOnFail","onOnCancel"]),c("div",{onClick:a[0]||(a[0]=(...l)=>e.changeImg&&e.changeImg(...l)),class:"bt"},[n(h,{style:"width: 25px;min-width:25px;height: 25px;",name:"svg:upload.svg"})])]),n(_,{style:{"margin-top":"15px"},type:"primary",onClick:e.handleUpload},{default:t(()=>[U(" 确认修改新头像 ")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),c("div",ge,[n(i,{style:{width:"100%"},model:e.dataContainer.form,ref:"FormElRef",inline:!1,rules:e.dataContainer.rules,"label-width":"120px"},{default:t(()=>[n(v,{gutter:0},{default:t(()=>[n(u,{span:24},{default:t(()=>[n(m,{label:"用户昵称",prop:"name"},{default:t(()=>[n(d,{modelValue:e.dataContainer.form.name,"onUpdate:modelValue":a[1]||(a[1]=l=>e.dataContainer.form.name=l),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),n(u,{span:24},{default:t(()=>[n(m,{label:"手机号码",prop:"newPassword"},{default:t(()=>[n(d,{modelValue:e.dataContainer.form.newPassword,"onUpdate:modelValue":a[2]||(a[2]=l=>e.dataContainer.form.newPassword=l),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),n(u,{span:24},{default:t(()=>[n(m,{label:"邮箱",prop:"newPassword_1"},{default:t(()=>[n(d,{modelValue:e.dataContainer.form.newPassword_1,"onUpdate:modelValue":a[3]||(a[3]=l=>e.dataContainer.form.newPassword_1=l),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),n(_,{type:"primary",onClick:e.handleSubmit},{default:t(()=>[U(" 确定提交 ")]),_:1},8,["onClick"])]),n(s,{ref:"ChangeImgDialogRef"},null,512)])}const we=V(ue,[["render",_e],["__scopeId","data-v-ce2df619"]]);export{we as default};
